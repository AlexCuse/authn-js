!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.KeratinAuthN=e()}}(function(){return function e(t,n,o){function i(r,u){if(!n[r]){if(!t[r]){var f="function"==typeof require&&require;if(!u&&f)return f(r,!0);if(s)return s(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[r]={exports:{}};t[r][0].call(c.exports,function(e){var n=t[r][1][e];return i(n?n:e)},c,c.exports,e,t,n,o)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t,n){"use strict";function o(e){h=e.replace(/\/$/,"")}function i(e){return new Promise(function(t,n){return p?void n("duplicate"):(p=!0,void c.post(a("/accounts"),e).then(function(e){return t(e.id_token)},function(e){return n(e)}).then(function(){return p=!1}))})}function s(e){return c.get(a("/accounts/available"),{username:e})}function r(){return c.get(a("/sessions/refresh"),{}).then(function(e){return e.id_token})}function u(e){return c.post(a("/sessions"),e).then(function(e){return e.id_token})}function f(){return new Promise(function(e){var t=document.createElement("iframe");t.onload=function(){t.remove(),e()},t.src=a("/sessions/logout");var n=t.style;n.height="0",n.width="0",n.border="0",document.querySelector("body").appendChild(t)})}function a(e){if(!h.length)throw"ISSUER not set";return""+h+e}var c=e("./verbs"),p=!1,h="";n.setHost=o,n.signup=i,n.isAvailable=s,n.refresh=r,n.login=u,n.logout=f},{"./verbs":7}],2:[function(e,t,n){"use strict";var o=e("./session"),i=function(){function e(e){this.sessionName=e,this.secureFlag="https:"===window.location.protocol?"; secure":"";var t=document.cookie.replace("(?:(?:^|.*;s*)"+this.sessionName+"s*=s*([^;]*).*$)|^.*$","$1");t&&(this.session=new o.Session(t))}return e.prototype.update=function(e){this.session=new o.Session(e),document.cookie=this.sessionName+"="+e+this.secureFlag},e.prototype.delete=function(){this.session=void 0,document.cookie=this.sessionName+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e}();n.CookieSessionStore=i},{"./session":5}],3:[function(e,t,n){"use strict";function o(e){return Object.keys(e).map(function(t){return i(t,e[t])}).join("&")}function i(e,t){return e+"="+encodeURIComponent(t)}n.formData=o},{}],4:[function(e,t,n){"use strict";function o(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}function i(e){a=new h.CookieSessionStore(e),c=new p.SessionManager(a),c.maintain()}function s(e){return d.signup(e).then(f)}function r(e){return d.login(e).then(f)}function u(){return d.logout().then(function(){if(!a)throw l;a.delete()})}function f(e){if(!c)throw l;return c.updateAndMaintain(e),e}var a,c,p=e("./session_manager"),h=e("./cookie_store"),d=e("./api"),l="AuthN must be configured with setSession()";n.setSessionName=i,n.signup=s,n.login=r,n.logout=u,o(e("./api"))},{"./api":1,"./cookie_store":2,"./session_manager":6}],5:[function(e,t,n){"use strict";function o(e){return JSON.parse(atob(e.split(".")[1]))}var i=function(){function e(e){this.token=e,this.claims=o(e)}return e.prototype.iat=function(){return this.claims.iat},e.prototype.exp=function(){return this.claims.exp},e.prototype.halflife=function(){return(this.exp()-this.iat())/2},e}();n.Session=i},{}],6:[function(e,t,n){"use strict";var o=e("./api"),i=function(){function e(e){this.store=e}return Object.defineProperty(e.prototype,"session",{get:function(){return this.store.session},enumerable:!0,configurable:!0}),e.prototype.maintain=function(){if(this.session){var e=1e3*(this.session.iat()+this.session.halflife()),t=(new Date).getTime();t<this.session.iat()||t>=e?this.refresh():this.scheduleRefresh(e-t)}},e.prototype.updateAndMaintain=function(e){this.store.update(e),this.session&&this.scheduleRefresh(1e3*this.session.halflife())},e.prototype.scheduleRefresh=function(e){var t=this;clearTimeout(this.timeoutID),this.timeoutID=setTimeout(function(){return t.refresh()},e)},e.prototype.refresh=function(){var e=this;o.refresh().then(function(t){return e.updateAndMaintain(t)},function(t){"Unauthorized"===t&&e.store.delete()})},e}();n.SessionManager=i},{"./api":1}],7:[function(e,t,n){"use strict";function o(e,t){return s(function(n){n.open("GET",e+"?"+r.formData(t)),n.send()})}function i(e,t){return s(function(n){n.open("POST",e),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(r.formData(t))})}function s(e){return new Promise(function(t,n){var o=new XMLHttpRequest;o.withCredentials=!0,o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE){var e=o.responseText.length>1?JSON.parse(o.responseText):{};e.result?t(e.result):n(e.errors?e.errors:o.statusText)}},e(o)})}var r=e("./form_data");n.get=o,n.post=i},{"./form_data":3}]},{},[4])(4)});