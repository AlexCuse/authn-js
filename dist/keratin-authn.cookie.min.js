!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.KeratinAuthN=e()}}(function(){return function e(n,t,i){function o(r,u){if(!t[r]){if(!n[r]){var f="function"==typeof require&&require;if(!u&&f)return f(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var a=t[r]={exports:{}};n[r][0].call(a.exports,function(e){var t=n[r][1][e];return o(t?t:e)},a,a.exports,e,n,t,i)}return t[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,n,t){"use strict";function i(e){return new Promise(function(n,t){return p?void t("duplicate"):(p=!0,void a.post(u("/accounts"),f(e)).then(function(e){return n(e.id_token)},function(e){return t(e)}).then(function(){return p=!1}))})}function o(e){return a.get(u("/accounts/available"),c("username",e))}function s(){return a.get(u("/sessions/refresh"),"").then(function(e){return e.id_token})}function r(e){return a.post(u("/sessions"),f(e)).then(function(e){return e.id_token})}function u(e){if(!t.ISSUER.length)throw"ISSUER not set";return""+t.ISSUER+e}function f(e){return c("username",e.username)+"&"+c("password",e.password)}function c(e,n){return e+"="+encodeURIComponent(n)}var a=e("./verbs"),p=!1;t.ISSUER="",t.signup=i,t.isAvailable=o,t.refresh=s,t.login=r},{"./verbs":6}],2:[function(e,n,t){"use strict";var i=e("./session"),o=function(){function e(e){this.sessionName=e,this.secureFlag="https:"===window.location.protocol?"; secure":"",this.session=new i.Session(document.cookie.replace("(?:(?:^|.*;s*)"+this.sessionName+"s*=s*([^;]*).*$)|^.*$","$1"))}return e.prototype.update=function(e){this.session=new i.Session(e),document.cookie=this.sessionName+"="+e+this.secureFlag},e.prototype.delete=function(){document.cookie=this.sessionName+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e}();t.CookieSessionStore=o},{"./session":4}],3:[function(e,n,t){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function o(e){c=new p.CookieSessionStore(e)}function s(e){return h.signup(e).then(f)}function r(e){return h.login(e).then(f)}function u(){if(!c)throw l;new a.SessionManager(c).maintain()}function f(e){if(!c)throw l;return c.update(e),e}var c,a=e("./session_manager"),p=e("./cookie_store"),h=e("./api"),l="AuthN must be configured with setSession()";t.setSession=o,t.signup=s,t.login=r,t.maintainSession=u,i(e("./api"))},{"./api":1,"./cookie_store":2,"./session_manager":5}],4:[function(e,n,t){"use strict";function i(e){return JSON.parse(atob(e.split(".")[1]))}var o=function(){function e(e){this.token=e,this.claims=i(e)}return e.prototype.iat=function(){return this.claims.iat},e.prototype.exp=function(){return this.claims.exp},e.prototype.halflife=function(){return(this.exp()-this.iat())/2},e}();t.Session=o},{}],5:[function(e,n,t){"use strict";var i=e("./api"),o=function(){function e(e){this.store=e}return Object.defineProperty(e.prototype,"session",{get:function(){return this.store.session},enumerable:!0,configurable:!0}),e.prototype.sessionIsActive=function(){return this.session.token.length>0},e.prototype.maintain=function(){var e=this;if(this.sessionIsActive()){var n=1e3*(this.session.iat()+this.session.halflife()),t=(new Date).getTime();t<this.session.iat()||t>=n?this.refresh():setTimeout(function(){return e.refresh()},n-t)}},e.prototype.refresh=function(){var e=this;i.refresh().then(function(n){e.store.update(n),setTimeout(e.refresh,1e3*e.session.halflife())},function(n){"Unauthorized"===n&&e.store.delete()})},e}();t.SessionManager=o},{"./api":1}],6:[function(e,n,t){"use strict";function i(e,n){return s(function(t){t.open("GET",e+"?"+n),t.send()})}function o(e,n){return s(function(t){t.open("POST",e),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)})}function s(e){return new Promise(function(n,t){var i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var e=i.responseText.length>1?JSON.parse(i.responseText):{};e.result?n(e.result):t(e.errors?e.errors:i.statusText)}},e(i)})}t.get=i,t.post=o},{}]},{},[3])(3)});