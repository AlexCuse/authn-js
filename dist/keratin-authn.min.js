"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){function e(e){return JSON.parse(atob(e.split(".")[1]))}function t(e){if(!u.ISSUER.length)throw"KeratinAuthN.ISSUER not set";return""+u.ISSUER+e}function n(e){return s("username",e.username)+"&"+s("password",e.password)}function s(e,t){return e+"="+encodeURIComponent(t)}function o(e,t){return r(function(n){n.open("GET",e+"?"+t),n.send()})}function i(e,t){return r(function(n){n.open("POST",e),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)})}function r(e){return new Promise(function(t,n){var s=new XMLHttpRequest;s.withCredentials=!0,s.onreadystatechange=function(){if(s.readyState==XMLHttpRequest.DONE){var e=s.responseText.length>1?JSON.parse(s.responseText):{};e.result?t(e.result):n(e.errors?e.errors:s.statusText)}},e(s)})}var u={ISSUER:"",signup:function(e){return new Promise(function(s,o){return h?void o("duplicate"):(h=!0,void i(t("/accounts"),n(e)).then(function(e){return s(e.id_token)},function(e){return o(e)}).then(function(){return h=!1}))})},isAvailable:function(e){return o(t("/accounts/available"),s("username",e))},refresh:function(){return o(t("/sessions/refresh"),"").then(function(e){return e.id_token})},login:function(e){return i(t("/sessions"),n(e)).then(function(e){return e.id_token})},maintainSession:function(e){var t=new f(new a(e));t.session.token.length&&t.maintain()}},c=function(){function t(t){this.token=t,this.claims=e(t)}return t.prototype.iat=function(){return this.claims.iat},t.prototype.exp=function(){return this.claims.exp},t.prototype.halflife=function(){return(this.exp()-this.iat())/2},t}(),a=function(){function e(e){this.sessionName=e,this.secureFlag="https:"===window.location.protocol?"; secure":"",this.session=new c(document.cookie.replace("(?:(?:^|.*;s*)"+this.sessionName+"s*=s*([^;]*).*$)|^.*$","$1"))}return e.prototype.update=function(e){this.session=new c(e),document.cookie=this.sessionName+"="+e+this.secureFlag},e.prototype.delete=function(){document.cookie=this.sessionName+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e}(),f=function(){function e(e){this.store=e}return Object.defineProperty(e.prototype,"session",{get:function(){return this.store.session},enumerable:!0,configurable:!0}),e.prototype.maintain=function(){var e=this,t=1e3*(this.session.iat()+this.session.halflife()),n=(new Date).getTime();n<this.session.iat()||n>=t?this.refresh():setTimeout(function(){return e.refresh()},t-n)},e.prototype.refresh=function(){var e=this;u.refresh().then(function(t){e.store.update(t),setTimeout(e.refresh,1e3*e.session.halflife())},function(t){"Unauthorized"===t&&e.store.delete()})},e}(),h=!1;return u}();